"use strict";(self.webpackChunkdocusaurus_osebna=self.webpackChunkdocusaurus_osebna||[]).push([["306"],{5178:function(e,n,s){s.r(n),s.d(n,{metadata:()=>r,contentTitle:()=>a,default:()=>h,assets:()=>o,toc:()=>d,frontMatter:()=>c});var r=JSON.parse('{"id":"postgresql/ldap-sync","title":"PostgreSQL LDAP User Sync","description":"Automatically synchronize users and groups from LDAP/Active Directory to PostgreSQL using pg-ldap-sync. This eliminates manual user management and keeps database access aligned with your directory service.","source":"@site/docs/postgresql/ldap-sync.mdx","sourceDirName":"postgresql","slug":"/postgresql/ldap-sync","permalink":"/docs/postgresql/ldap-sync","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"PostgreSQL PAM Authentication","permalink":"/docs/postgresql/pam-authentication"},"next":{"title":"Upgrading PostgreSQL on AlmaLinux","permalink":"/docs/postgresql/upgrade-postgresql"}}'),l=s("5893"),i=s("65");let c={sidebar_position:2},a="PostgreSQL LDAP User Sync",o={},d=[{value:"What is pg-ldap-sync?",id:"what-is-pg-ldap-sync",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1: Create Base Roles in PostgreSQL",id:"step-1-create-base-roles-in-postgresql",level:2},{value:"Step 2: Install pg-ldap-sync",id:"step-2-install-pg-ldap-sync",level:2},{value:"Standard Installation (Direct Internet Access)",id:"standard-installation-direct-internet-access",level:3},{value:"RHEL/AlmaLinux/Rocky Linux",id:"rhelalmalinuxrocky-linux",level:3},{value:"Behind Corporate Proxy",id:"behind-corporate-proxy",level:3},{value:"Add Ruby Gems to PATH",id:"add-ruby-gems-to-path",level:3},{value:"Step 3: Create Configuration File",id:"step-3-create-configuration-file",level:2},{value:"Configuration Explanation",id:"configuration-explanation",level:3},{value:"Step 4: Test the Configuration",id:"step-4-test-the-configuration",level:2},{value:"Step 5: Run the Sync",id:"step-5-run-the-sync",level:2},{value:"Verification",id:"verification",level:2},{value:"Check Synced Users",id:"check-synced-users",level:3},{value:"Check Synced Groups",id:"check-synced-groups",level:3},{value:"Check Group Memberships",id:"check-group-memberships",level:3},{value:"Automation with Cron",id:"automation-with-cron",level:2},{value:"Advanced Configuration",id:"advanced-configuration",level:2},{value:"Use LDAPS (Secure LDAP)",id:"use-ldaps-secure-ldap",level:3},{value:"Filter Specific OUs",id:"filter-specific-ous",level:3},{value:"Exclude Certain Groups",id:"exclude-certain-groups",level:3},{value:"Grant Additional Privileges",id:"grant-additional-privileges",level:3},{value:"Disable User Deletion",id:"disable-user-deletion",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Connection Issues",id:"connection-issues",level:3},{value:"No Users Found",id:"no-users-found",level:3},{value:"Permission Denied",id:"permission-denied",level:3},{value:"Ruby Gem Path Issues",id:"ruby-gem-path-issues",level:3},{value:"Security Best Practices",id:"security-best-practices",level:2},{value:"Common LDAP Filters",id:"common-ldap-filters",level:2},{value:"Active Directory",id:"active-directory",level:3},{value:"OpenLDAP",id:"openldap",level:3},{value:"Additional Resources",id:"additional-resources",level:2}];function t(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"postgresql-ldap-user-sync",children:"PostgreSQL LDAP User Sync"})}),"\n",(0,l.jsxs)(n.p,{children:["Automatically synchronize users and groups from LDAP/Active Directory to PostgreSQL using ",(0,l.jsx)(n.code,{children:"pg-ldap-sync"}),". This eliminates manual user management and keeps database access aligned with your directory service."]}),"\n",(0,l.jsx)(n.h2,{id:"what-is-pg-ldap-sync",children:"What is pg-ldap-sync?"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"pg-ldap-sync"})," is a Ruby tool that:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Synchronizes LDAP/AD users and groups to PostgreSQL roles"}),"\n",(0,l.jsx)(n.li,{children:"Maintains group memberships automatically"}),"\n",(0,l.jsx)(n.li,{children:"Can run as a scheduled task for continuous sync"}),"\n",(0,l.jsx)(n.li,{children:"Supports filtering and custom role options"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"PostgreSQL database with superuser access"}),"\n",(0,l.jsx)(n.li,{children:"LDAP/Active Directory server access"}),"\n",(0,l.jsx)(n.li,{children:"Ruby installed on the system"}),"\n",(0,l.jsx)(n.li,{children:"Network connectivity between PostgreSQL and LDAP server"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"step-1-create-base-roles-in-postgresql",children:"Step 1: Create Base Roles in PostgreSQL"}),"\n",(0,l.jsx)(n.p,{children:"Create two parent roles that will contain all synced users and groups:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"CREATE ROLE ldap_users;\nCREATE ROLE ldap_groups;\n"})}),"\n",(0,l.jsxs)(n.p,{children:["These roles act as containers. All synced LDAP users will be members of ",(0,l.jsx)(n.code,{children:"ldap_users"}),", and all synced groups will be members of ",(0,l.jsx)(n.code,{children:"ldap_groups"}),"."]}),"\n",(0,l.jsxs)(n.admonition,{title:"Grant Permissions",type:"tip",children:[(0,l.jsx)(n.p,{children:"After sync, grant database permissions to these parent roles:"}),(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"GRANT CONNECT ON DATABASE mydb TO ldap_users;\nGRANT USAGE ON SCHEMA public TO ldap_users;\nGRANT SELECT ON ALL TABLES IN SCHEMA public TO ldap_users;\n"})})]}),"\n",(0,l.jsx)(n.h2,{id:"step-2-install-pg-ldap-sync",children:"Step 2: Install pg-ldap-sync"}),"\n",(0,l.jsx)(n.h3,{id:"standard-installation-direct-internet-access",children:"Standard Installation (Direct Internet Access)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"gem install pg-ldap-sync\n"})}),"\n",(0,l.jsx)(n.h3,{id:"rhelalmalinuxrocky-linux",children:"RHEL/AlmaLinux/Rocky Linux"}),"\n",(0,l.jsx)(n.p,{children:"Install dependencies:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo dnf install ruby ruby-devel postgresql16-devel\n"})}),"\n",(0,l.jsx)(n.p,{children:"Install with PostgreSQL config path:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"gem install pg-ldap-sync -- --with-pg-config=/usr/pgsql-16/bin/pg_config\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Replace ",(0,l.jsx)(n.code,{children:"16"})," with your PostgreSQL version (e.g., ",(0,l.jsx)(n.code,{children:"15"}),", ",(0,l.jsx)(n.code,{children:"17"}),")."]}),"\n",(0,l.jsx)(n.h3,{id:"behind-corporate-proxy",children:"Behind Corporate Proxy"}),"\n",(0,l.jsx)(n.p,{children:"If behind a proxy, specify it during installation:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"gem install --http-proxy http://proxy.example.com:80 pg-ldap-sync -- --with-pg_config=/usr/pgsql-16/bin/pg_config\n"})}),"\n",(0,l.jsx)(n.h3,{id:"add-ruby-gems-to-path",children:"Add Ruby Gems to PATH"}),"\n",(0,l.jsx)(n.p,{children:"After installation, add the gem binary path to your PATH:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"vi ~/.bashrc\n"})}),"\n",(0,l.jsx)(n.p,{children:"Add this line (adjust Ruby version as needed):"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'export PATH="$HOME/.local/share/gem/ruby/3.0.0/bin:$PATH"\n'})}),"\n",(0,l.jsx)(n.p,{children:"Apply changes:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"source ~/.bashrc\n"})}),"\n",(0,l.jsx)(n.p,{children:"Verify installation:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"pg_ldap_sync --version\n"})}),"\n",(0,l.jsx)(n.h2,{id:"step-3-create-configuration-file",children:"Step 3: Create Configuration File"}),"\n",(0,l.jsxs)(n.p,{children:["Create a YAML configuration file (e.g., ",(0,l.jsx)(n.code,{children:"pgldapsync.yml"}),"):"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"# Connection parameters to LDAP server\nldap_connection:\n  host: ldap.example.com\n  port: 389\n  auth:\n    method: :simple\n    username: cn=readonly,cn=Users,dc=example,dc=com\n    password: YourLDAPPassword\n\n# Search parameters for LDAP users\nldap_users:\n  base: dc=example,dc=com\n  filter: (&(objectClass=User)(objectCategory=Person))\n  name_attribute: sAMAccountName\n  lowercase_name: true\n  bothcase_name: false\n\n# Search parameters for LDAP groups\nldap_groups:\n  base: dc=example,dc=com\n  filter: (objectClass=group)\n  name_attribute: cn\n  lowercase_name: false\n  member_attribute: member\n\n# Connection parameters to PostgreSQL server\npg_connection:\n  host: localhost\n  port: 5432\n  dbname: postgres\n  user: postgres\n  password: YourPostgresPassword\n\n# PostgreSQL user filter and options\npg_users:\n  filter: oid IN (SELECT pam.member FROM pg_auth_members pam JOIN pg_roles pr ON pr.oid=pam.roleid WHERE pr.rolname='ldap_users')\n  create_options: LOGIN IN ROLE ldap_users\n\n# PostgreSQL group filter and options\npg_groups:\n  filter: oid IN (SELECT pam.member FROM pg_auth_members pam JOIN pg_roles pr ON pr.oid=pam.roleid WHERE pr.rolname='ldap_groups')\n  create_options: NOLOGIN IN ROLE ldap_groups\n"})}),"\n",(0,l.jsx)(n.h3,{id:"configuration-explanation",children:"Configuration Explanation"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"LDAP Connection:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"host"}),": LDAP/AD server hostname or IP"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"port"}),": 389 (LDAP) or 636 (LDAPS)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"auth.username"}),": Service account with read access to users/groups"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"auth.password"}),": Service account password"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"LDAP Users:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"base"}),": Starting point for user search (DN)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"filter"}),": LDAP filter to match users (Active Directory example shown)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"name_attribute"}),": LDAP attribute to use as PostgreSQL role name (usually ",(0,l.jsx)(n.code,{children:"sAMAccountName"})," or ",(0,l.jsx)(n.code,{children:"uid"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"lowercase_name"}),": Convert usernames to lowercase"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"bothcase_name"}),": Create both original and lowercase versions"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"LDAP Groups:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"base"}),": Starting point for group search"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"filter"}),": LDAP filter to match groups"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"name_attribute"}),": Attribute to use as role name (usually ",(0,l.jsx)(n.code,{children:"cn"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"member_attribute"}),": Attribute containing group members (usually ",(0,l.jsx)(n.code,{children:"member"})," or ",(0,l.jsx)(n.code,{children:"memberUid"}),")"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"PostgreSQL Connection:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Standard PostgreSQL connection parameters"}),"\n",(0,l.jsxs)(n.li,{children:["User must have ",(0,l.jsx)(n.code,{children:"CREATEROLE"})," privilege"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"PostgreSQL Filters:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Define which existing PostgreSQL roles belong to the sync scope"}),"\n",(0,l.jsx)(n.li,{children:"Only roles matching the filter will be managed by sync"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"step-4-test-the-configuration",children:"Step 4: Test the Configuration"}),"\n",(0,l.jsx)(n.p,{children:"Run in test mode (dry-run) to see what would happen:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"pg_ldap_sync -c /path/to/pgldapsync.yml -vv -t\n"})}),"\n",(0,l.jsx)(n.p,{children:"Flags:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"-c"}),": Configuration file path"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"-vv"}),": Very verbose output (shows all operations)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"-t"}),": Test mode (no changes made)"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Review the output carefully:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Check if correct users/groups are found"}),"\n",(0,l.jsx)(n.li,{children:"Verify no unwanted users/groups are being deleted"}),"\n",(0,l.jsx)(n.li,{children:"Ensure role options look correct"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"step-5-run-the-sync",children:"Step 5: Run the Sync"}),"\n",(0,l.jsx)(n.p,{children:"If test mode looks good, run the actual sync:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"pg_ldap_sync -c /path/to/pgldapsync.yml -vv\n"})}),"\n",(0,l.jsx)(n.p,{children:"This will:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Create missing PostgreSQL roles for LDAP users"}),"\n",(0,l.jsx)(n.li,{children:"Create missing PostgreSQL roles for LDAP groups"}),"\n",(0,l.jsx)(n.li,{children:"Update group memberships"}),"\n",(0,l.jsx)(n.li,{children:"Remove roles that no longer exist in LDAP (if configured)"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"verification",children:"Verification"}),"\n",(0,l.jsx)(n.h3,{id:"check-synced-users",children:"Check Synced Users"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- List all synced users\nSELECT rolname FROM pg_roles \nWHERE oid IN (\n  SELECT member FROM pg_auth_members \n  WHERE roleid = (SELECT oid FROM pg_roles WHERE rolname = 'ldap_users')\n) ORDER BY rolname;\n"})}),"\n",(0,l.jsx)(n.h3,{id:"check-synced-groups",children:"Check Synced Groups"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- List all synced groups\nSELECT rolname FROM pg_roles \nWHERE oid IN (\n  SELECT member FROM pg_auth_members \n  WHERE roleid = (SELECT oid FROM pg_roles WHERE rolname = 'ldap_groups')\n) ORDER BY rolname;\n"})}),"\n",(0,l.jsx)(n.h3,{id:"check-group-memberships",children:"Check Group Memberships"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- Show users and their group memberships\nSELECT \n  u.rolname AS username,\n  g.rolname AS groupname\nFROM pg_roles u\nJOIN pg_auth_members m ON u.oid = m.member\nJOIN pg_roles g ON g.oid = m.roleid\nWHERE u.oid IN (\n  SELECT member FROM pg_auth_members \n  WHERE roleid = (SELECT oid FROM pg_roles WHERE rolname = 'ldap_users')\n)\nORDER BY u.rolname, g.rolname;\n"})}),"\n",(0,l.jsx)(n.h2,{id:"automation-with-cron",children:"Automation with Cron"}),"\n",(0,l.jsx)(n.p,{children:"Set up automatic sync every hour:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"crontab -e\n"})}),"\n",(0,l.jsx)(n.p,{children:"Add:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"0 * * * * /usr/local/bin/pg_ldap_sync -c /etc/pgldapsync.yml >> /var/log/pg-ldap-sync.log 2>&1\n"})}),"\n",(0,l.jsx)(n.p,{children:"Or use systemd timer for better logging."}),"\n",(0,l.jsx)(n.h2,{id:"advanced-configuration",children:"Advanced Configuration"}),"\n",(0,l.jsx)(n.h3,{id:"use-ldaps-secure-ldap",children:"Use LDAPS (Secure LDAP)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"ldap_connection:\n  host: ldap.example.com\n  port: 636\n  encryption: :simple_tls\n  auth:\n    method: :simple\n    username: cn=readonly,dc=example,dc=com\n    password: YourPassword\n"})}),"\n",(0,l.jsx)(n.h3,{id:"filter-specific-ous",children:"Filter Specific OUs"}),"\n",(0,l.jsx)(n.p,{children:"Only sync users from specific organizational units:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"ldap_users:\n  base: ou=Employees,dc=example,dc=com\n  filter: (&(objectClass=User)(objectCategory=Person))\n"})}),"\n",(0,l.jsx)(n.h3,{id:"exclude-certain-groups",children:"Exclude Certain Groups"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"ldap_groups:\n  filter: (&(objectClass=group)(!(cn=Domain Users)))\n"})}),"\n",(0,l.jsx)(n.h3,{id:"grant-additional-privileges",children:"Grant Additional Privileges"}),"\n",(0,l.jsxs)(n.p,{children:["Modify ",(0,l.jsx)(n.code,{children:"create_options"})," to add more role attributes:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"pg_users:\n  create_options: LOGIN IN ROLE ldap_users CREATEROLE\n"})}),"\n",(0,l.jsx)(n.h3,{id:"disable-user-deletion",children:"Disable User Deletion"}),"\n",(0,l.jsx)(n.p,{children:"Prevent removal of users that no longer exist in LDAP:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"pg_users:\n  disable_delete: true\n"})}),"\n",(0,l.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,l.jsx)(n.h3,{id:"connection-issues",children:"Connection Issues"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"LDAP Connection Failed:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Test LDAP connection\nldapsearch -x -H ldap://ldap.example.com:389 -D "cn=readonly,dc=example,dc=com" -w password -b "dc=example,dc=com"\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"PostgreSQL Connection Failed:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Test PostgreSQL connection\npsql -h localhost -p 5432 -U postgres -d postgres\n"})}),"\n",(0,l.jsx)(n.h3,{id:"no-users-found",children:"No Users Found"}),"\n",(0,l.jsx)(n.p,{children:"Check your LDAP filter:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'ldapsearch -x -H ldap://ldap.example.com -D "cn=readonly,dc=example,dc=com" -w password -b "dc=example,dc=com" "(&(objectClass=User)(objectCategory=Person))"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"permission-denied",children:"Permission Denied"}),"\n",(0,l.jsxs)(n.p,{children:["Ensure PostgreSQL user has ",(0,l.jsx)(n.code,{children:"CREATEROLE"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"ALTER ROLE postgres CREATEROLE;\n"})}),"\n",(0,l.jsx)(n.h3,{id:"ruby-gem-path-issues",children:"Ruby Gem Path Issues"}),"\n",(0,l.jsx)(n.p,{children:"Check gem installation path:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"gem environment\n"})}),"\n",(0,l.jsx)(n.p,{children:"Add to PATH if needed:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"export PATH=\"$(ruby -e 'puts Gem.user_dir')/bin:$PATH\"\n"})}),"\n",(0,l.jsx)(n.h2,{id:"security-best-practices",children:"Security Best Practices"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Use Read-Only LDAP Account"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Create a dedicated service account"}),"\n",(0,l.jsx)(n.li,{children:"Grant only read permissions"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Secure Configuration File"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"chmod 600 /etc/pgldapsync.yml\nchown postgres:postgres /etc/pgldapsync.yml\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Use LDAPS"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Always use encrypted LDAP connections in production"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Limit PostgreSQL Permissions"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Sync user only needs ",(0,l.jsx)(n.code,{children:"CREATEROLE"})," privilege"]}),"\n",(0,l.jsx)(n.li,{children:"Don't use superuser for sync"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Monitor Sync Logs"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Review sync logs regularly"}),"\n",(0,l.jsx)(n.li,{children:"Alert on errors or unexpected changes"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Test Before Production"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Always test configuration changes in development"}),"\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"-t"})," flag to preview changes"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"common-ldap-filters",children:"Common LDAP Filters"}),"\n",(0,l.jsx)(n.h3,{id:"active-directory",children:"Active Directory"}),"\n",(0,l.jsx)(n.p,{children:"Users only:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"filter: (&(objectClass=User)(objectCategory=Person)(!(userAccountControl:1.2.840.113556.1.4.803:=2)))\n"})}),"\n",(0,l.jsx)(n.p,{children:"Specific group members:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"filter: (&(objectClass=User)(memberOf=cn=DatabaseUsers,ou=Groups,dc=example,dc=com))\n"})}),"\n",(0,l.jsx)(n.h3,{id:"openldap",children:"OpenLDAP"}),"\n",(0,l.jsx)(n.p,{children:"Users with posixAccount:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"filter: (&(objectClass=posixAccount)(uid=*))\n"})}),"\n",(0,l.jsx)(n.p,{children:"Groups with posixGroup:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"filter: (objectClass=posixGroup)\nmember_attribute: memberUid\n"})}),"\n",(0,l.jsx)(n.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/larskanis/pg-ldap-sync",children:"pg-ldap-sync GitHub Repository"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/user-manag.html",children:"PostgreSQL Roles Documentation"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://ldap.com/ldap-filters/",children:"LDAP Search Filters Guide"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/windows/win32/adsi/search-filter-syntax",children:"Active Directory LDAP Syntax"})}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(t,{...e})}):t(e)}},65:function(e,n,s){s.d(n,{Z:function(){return a},a:function(){return c}});var r=s(7294);let l={},i=r.createContext(l);function c(e){let n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:c(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);