"use strict";(self.webpackChunkdocusaurus_osebna=self.webpackChunkdocusaurus_osebna||[]).push([["2632"],{1738:function(e,n,s){s.r(n),s.d(n,{metadata:()=>i,contentTitle:()=>r,default:()=>c,assets:()=>t,toc:()=>h,frontMatter:()=>o});var i=JSON.parse('{"id":"ansible/zsh-system-wide","title":"Install ZSH System-Wide with Ansible","description":"Automated installation and configuration of ZSH with Oh-My-Zsh, Powerlevel10k theme, and useful plugins for multiple users across multiple servers.","source":"@site/docs/ansible/zsh-system-wide.mdx","sourceDirName":"ansible","slug":"/ansible/zsh-system-wide","permalink":"/docs/ansible/zsh-system-wide","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Ansible","permalink":"/docs/category/ansible"},"next":{"title":"PostgreSQL","permalink":"/docs/category/postgresql"}}'),l=s("5893"),a=s("65");let o={sidebar_position:1},r="Install ZSH System-Wide with Ansible",t={},h=[{value:"Overview",id:"overview",level:2},{value:"Project Structure",id:"project-structure",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"On Control Node (Your Machine)",id:"on-control-node-your-machine",level:3},{value:"On Target Servers",id:"on-target-servers",level:3},{value:"Part 1: Inventory Configuration",id:"part-1-inventory-configuration",level:2},{value:"Inventory Explanation",id:"inventory-explanation",level:3},{value:"Multiple Groups",id:"multiple-groups",level:3},{value:"Part 2: The Playbook",id:"part-2-the-playbook",level:2},{value:"Playbook Breakdown",id:"playbook-breakdown",level:3},{value:"Variables Section",id:"variables-section",level:4},{value:"Key Tasks",id:"key-tasks",level:4},{value:"Part 3: Configuration Files",id:"part-3-configuration-files",level:2},{value:"Create files Directory",id:"create-files-directory",level:3},{value:"files/zshrc",id:"fileszshrc",level:3},{value:"files/p10k.zsh",id:"filesp10kzsh",level:3},{value:"Part 4: Running the Playbook",id:"part-4-running-the-playbook",level:2},{value:"Test Connection",id:"test-connection",level:3},{value:"Dry Run (Check Mode)",id:"dry-run-check-mode",level:3},{value:"Execute Playbook",id:"execute-playbook",level:3},{value:"Execute with Verbose Output",id:"execute-with-verbose-output",level:3},{value:"Target Specific Hosts",id:"target-specific-hosts",level:3},{value:"Part 5: Verification",id:"part-5-verification",level:2},{value:"SSH into Server",id:"ssh-into-server",level:3},{value:"Verify Shell",id:"verify-shell",level:3},{value:"Check Oh-My-Zsh",id:"check-oh-my-zsh",level:3},{value:"Check Plugins",id:"check-plugins",level:3},{value:"Check Theme",id:"check-theme",level:3},{value:"Test Autosuggestions",id:"test-autosuggestions",level:3},{value:"Test Syntax Highlighting",id:"test-syntax-highlighting",level:3},{value:"Part 6: Customization",id:"part-6-customization",level:2},{value:"Add More Users",id:"add-more-users",level:3},{value:"Add More Plugins",id:"add-more-plugins",level:3},{value:"Custom Aliases",id:"custom-aliases",level:3},{value:"Configure for Specific Distributions",id:"configure-for-specific-distributions",level:3},{value:"Part 7: Advanced Configuration",id:"part-7-advanced-configuration",level:2},{value:"Use Ansible Vault for Sensitive Data",id:"use-ansible-vault-for-sensitive-data",level:3},{value:"Use SSH Key Authentication",id:"use-ssh-key-authentication",level:3},{value:"Install Fonts (Optional)",id:"install-fonts-optional",level:3},{value:"Part 8: Troubleshooting",id:"part-8-troubleshooting",level:2},{value:"Playbook Fails with Permission Denied",id:"playbook-fails-with-permission-denied",level:3},{value:"Oh-My-Zsh Installation Fails",id:"oh-my-zsh-installation-fails",level:3},{value:"Shell Doesn&#39;t Change",id:"shell-doesnt-change",level:3},{value:"Plugins Don&#39;t Work",id:"plugins-dont-work",level:3},{value:"Powerlevel10k Not Showing",id:"powerlevel10k-not-showing",level:3},{value:"Part 9: Idempotency",id:"part-9-idempotency",level:2},{value:"Part 10: Uninstall (Optional)",id:"part-10-uninstall-optional",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Additional Resources",id:"additional-resources",level:2},{value:"Example Output",id:"example-output",level:2}];function d(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"install-zsh-system-wide-with-ansible",children:"Install ZSH System-Wide with Ansible"})}),"\n",(0,l.jsx)(n.p,{children:"Automated installation and configuration of ZSH with Oh-My-Zsh, Powerlevel10k theme, and useful plugins for multiple users across multiple servers."}),"\n",(0,l.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,l.jsx)(n.p,{children:"This Ansible playbook installs and configures:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"ZSH shell"}),": Modern shell with powerful features"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Oh-My-Zsh"}),": Framework for managing ZSH configuration"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Powerlevel10k"}),": Beautiful and fast ZSH theme"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Plugins"}),": zsh-autosuggestions and zsh-syntax-highlighting"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"System-wide configuration"}),": Apply to multiple users simultaneously"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"project-structure",children:"Project Structure"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"ansible-zsh/\n\u251C\u2500\u2500 zsh-playbook.yml          # Main Ansible playbook\n\u251C\u2500\u2500 hosts.ini                 # Inventory file with target hosts\n\u2514\u2500\u2500 files/\n    \u251C\u2500\u2500 zshrc                 # ZSH configuration file\n    \u2514\u2500\u2500 p10k.zsh             # Powerlevel10k theme configuration\n"})}),"\n",(0,l.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,l.jsx)(n.h3,{id:"on-control-node-your-machine",children:"On Control Node (Your Machine)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Ansible installed (version 2.9+)"}),"\n",(0,l.jsx)(n.li,{children:"SSH access to target servers"}),"\n",(0,l.jsx)(n.li,{children:"SSH key-based authentication configured"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Install Ansible:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Ubuntu/Debian\nsudo apt update\nsudo apt install ansible\n\n# RHEL/Rocky/AlmaLinux\nsudo dnf install ansible\n\n# macOS\nbrew install ansible\n"})}),"\n",(0,l.jsx)(n.h3,{id:"on-target-servers",children:"On Target Servers"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"SSH server running"}),"\n",(0,l.jsx)(n.li,{children:"Sudo privileges for the Ansible user"}),"\n",(0,l.jsx)(n.li,{children:"Internet connection for downloading packages"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"part-1-inventory-configuration",children:"Part 1: Inventory Configuration"}),"\n",(0,l.jsxs)(n.p,{children:["Create ",(0,l.jsx)(n.code,{children:"hosts.ini"})," to define your target servers:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:"[hosts]\n192.168.1.10 ansible_user=admin\n192.168.1.11 ansible_user=admin\n192.168.1.12 ansible_user=admin\n192.168.1.13 ansible_user=sysadmin\n\n# Optional: Use localhost\n# localhost ansible_connection=local\n"})}),"\n",(0,l.jsx)(n.h3,{id:"inventory-explanation",children:"Inventory Explanation"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"192.168.1.10"}),": Target server IP address"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"ansible_user=admin"}),": SSH user with sudo privileges"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"[hosts]"}),": Group name (referenced in playbook as ",(0,l.jsx)(n.code,{children:"hosts: all"}),")"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"multiple-groups",children:"Multiple Groups"}),"\n",(0,l.jsx)(n.p,{children:"You can organize servers into groups:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:"[webservers]\n192.168.1.10 ansible_user=admin\n192.168.1.11 ansible_user=admin\n\n[databases]\n192.168.1.20 ansible_user=dbadmin\n192.168.1.21 ansible_user=dbadmin\n\n[development]\n192.168.1.30 ansible_user=developer\n"})}),"\n",(0,l.jsx)(n.p,{children:"Then target specific groups in your playbook:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"hosts: webservers  # Only web servers\n# or\nhosts: all         # All servers\n"})}),"\n",(0,l.jsx)(n.h2,{id:"part-2-the-playbook",children:"Part 2: The Playbook"}),"\n",(0,l.jsxs)(n.p,{children:["Create ",(0,l.jsx)(n.code,{children:"zsh-playbook.yml"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'---\n- name: Install and configure zsh\n  hosts: all\n  become: yes\n\n  vars:\n    users:\n      - name: admin\n        home: /home/admin\n      - name: developer\n        home: /home/developer\n      - name: root\n        home: /root\n\n  tasks:\n\n    - name: Install zsh using package manager\n      package:\n        name: zsh\n        state: present\n\n    - name: Install util-linux-user on RHEL-based systems\n      dnf:\n        name: "util-linux-user,git,tar"\n        state: present\n      when: "\'RedHat\' in ansible_distribution or \'Rocky\' in ansible_distribution or \'AlmaLinux\' in ansible_distribution"\n\n    - name: Modify /etc/pam.d/chsh for unrestricted chsh\n      lineinfile:\n        path: /etc/pam.d/chsh\n        regexp: \'^auth\\s+required\\s+pam_shells.so\'\n        line: \'auth sufficient pam_shells.so\'\n        state: present\n        backup: yes\n\n    - name: Change shell for users\n      command: chsh -s /usr/bin/zsh {{ item.name }}\n      loop: "{{ users }}"\n\n    - name: Check if .oh-my-zsh exists\n      stat:\n        path: ~/.oh-my-zsh\n      register: oh_my_zsh_stat\n\n    - name: Install .oh-my-zsh\n      become_user: "{{ item.name }}"\n      shell: "curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh | /bin/sh"\n      loop: "{{ users }}"\n      when: not oh_my_zsh_stat.stat.exists\n\n    - name: Clone powerlevel10k theme for users\n      git:\n        repo: "https://github.com/romkatv/powerlevel10k.git"\n        dest: "{{ item.home }}/.oh-my-zsh/custom/themes/powerlevel10k"\n        depth: 1\n      loop: "{{ users }}"\n\n    - name: Clone zsh-autosuggestions plugin\n      git:\n        repo: "https://github.com/zsh-users/zsh-autosuggestions.git"\n        dest: "{{ item.home }}/.oh-my-zsh/custom/plugins/zsh-autosuggestions"\n      loop: "{{ users }}"\n\n    - name: Clone zsh-syntax-highlighting plugin\n      git:\n        repo: "https://github.com/zsh-users/zsh-syntax-highlighting.git"\n        dest: "{{ item.home }}/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting"\n      loop: "{{ users }}"\n\n    - name: Copy zshrc file\n      copy:\n        src: "files/zshrc"\n        dest: "{{ item.home }}/.zshrc"\n      loop: "{{ users }}"\n\n    - name: Copy p10k.zsh file\n      copy:\n        src: "files/p10k.zsh"\n        dest: "{{ item.home }}/.p10k.zsh"\n      loop: "{{ users }}"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"playbook-breakdown",children:"Playbook Breakdown"}),"\n",(0,l.jsx)(n.h4,{id:"variables-section",children:"Variables Section"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"vars:\n  users:\n    - name: admin\n      home: /home/admin\n    - name: developer\n      home: /home/developer\n    - name: root\n      home: /root\n"})}),"\n",(0,l.jsx)(n.p,{children:"Define all users who should get ZSH. Add or remove users as needed."}),"\n",(0,l.jsx)(n.h4,{id:"key-tasks",children:"Key Tasks"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Install ZSH"}),": Uses generic ",(0,l.jsx)(n.code,{children:"package"})," module (works on Debian, Ubuntu, RHEL, Rocky, etc.)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Install utilities"}),": On RHEL-based systems, installs ",(0,l.jsx)(n.code,{children:"util-linux-user"})," (provides ",(0,l.jsx)(n.code,{children:"chsh"}),"), git, and tar"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Modify PAM"}),": Allows changing shell without restriction"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Change shell"}),": Sets ZSH as default shell for each user"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Install Oh-My-Zsh"}),": Downloads and installs the framework"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Clone theme/plugins"}),": Installs Powerlevel10k theme and useful plugins"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Copy configs"}),": Deploys your custom ",(0,l.jsx)(n.code,{children:".zshrc"})," and ",(0,l.jsx)(n.code,{children:".p10k.zsh"})," files"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"part-3-configuration-files",children:"Part 3: Configuration Files"}),"\n",(0,l.jsx)(n.h3,{id:"create-files-directory",children:"Create files Directory"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"mkdir -p files\n"})}),"\n",(0,l.jsx)(n.h3,{id:"fileszshrc",children:"files/zshrc"}),"\n",(0,l.jsxs)(n.p,{children:["Create ",(0,l.jsx)(n.code,{children:"files/zshrc"})," with your ZSH configuration:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Enable Powerlevel10k instant prompt\nif [[ -r \"${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh\" ]]; then\n  source \"${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh\"\nfi\n\n# Path to oh-my-zsh installation\nexport ZSH=\"$HOME/.oh-my-zsh\"\n\n# Set theme\nZSH_THEME=\"powerlevel10k/powerlevel10k\"\n\n# Plugins\nplugins=(\n  git\n  docker\n  kubectl\n  zsh-autosuggestions\n  zsh-syntax-highlighting\n)\n\nsource $ZSH/oh-my-zsh.sh\n\n# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh\n[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh\n\n# Custom aliases\nalias ll='ls -lah'\nalias update='sudo dnf update -y'\nalias reload='source ~/.zshrc'\n\n# Environment variables\nexport EDITOR='vim'\nexport VISUAL='vim'\n"})}),"\n",(0,l.jsx)(n.h3,{id:"filesp10kzsh",children:"files/p10k.zsh"}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"p10k.zsh"})," file contains Powerlevel10k theme configuration. You can:"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Option 1"}),": Generate it by running ",(0,l.jsx)(n.code,{children:"p10k configure"})," on your machine, then copy the generated ",(0,l.jsx)(n.code,{children:"~/.p10k.zsh"})," to ",(0,l.jsx)(n.code,{children:"files/p10k.zsh"})]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Option 2"}),": Use a basic configuration (the file is ~4000 lines, so it's best to copy from an existing setup)"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Option 3"}),": Let users configure it themselves after deployment by running ",(0,l.jsx)(n.code,{children:"p10k configure"})]}),"\n",(0,l.jsxs)(n.admonition,{title:"Quick Setup",type:"tip",children:[(0,l.jsxs)(n.p,{children:["If you don't have a ",(0,l.jsx)(n.code,{children:"p10k.zsh"})," file yet:"]}),(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Install ZSH and Powerlevel10k locally"}),"\n",(0,l.jsxs)(n.li,{children:["Run ",(0,l.jsx)(n.code,{children:"p10k configure"})," and follow the wizard"]}),"\n",(0,l.jsxs)(n.li,{children:["Copy the generated ",(0,l.jsx)(n.code,{children:"~/.p10k.zsh"})," to your ",(0,l.jsx)(n.code,{children:"files/"})," directory"]}),"\n"]})]}),"\n",(0,l.jsx)(n.h2,{id:"part-4-running-the-playbook",children:"Part 4: Running the Playbook"}),"\n",(0,l.jsx)(n.h3,{id:"test-connection",children:"Test Connection"}),"\n",(0,l.jsx)(n.p,{children:"First, verify Ansible can reach your servers:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ansible -i hosts.ini all -m ping\n"})}),"\n",(0,l.jsx)(n.p,{children:"Expected output:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'192.168.1.10 | SUCCESS => {\n    "changed": false,\n    "ping": "pong"\n}\n192.168.1.11 | SUCCESS => {\n    "changed": false,\n    "ping": "pong"\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"dry-run-check-mode",children:"Dry Run (Check Mode)"}),"\n",(0,l.jsx)(n.p,{children:"Test the playbook without making changes:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ansible-playbook -i hosts.ini zsh-playbook.yml --check\n"})}),"\n",(0,l.jsx)(n.h3,{id:"execute-playbook",children:"Execute Playbook"}),"\n",(0,l.jsx)(n.p,{children:"Run the playbook:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ansible-playbook -i hosts.ini zsh-playbook.yml\n"})}),"\n",(0,l.jsx)(n.h3,{id:"execute-with-verbose-output",children:"Execute with Verbose Output"}),"\n",(0,l.jsx)(n.p,{children:"For debugging:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ansible-playbook -i hosts.ini zsh-playbook.yml -v\n# or more verbose\nansible-playbook -i hosts.ini zsh-playbook.yml -vvv\n"})}),"\n",(0,l.jsx)(n.h3,{id:"target-specific-hosts",children:"Target Specific Hosts"}),"\n",(0,l.jsx)(n.p,{children:"Run only on specific servers:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Single host\nansible-playbook -i hosts.ini zsh-playbook.yml --limit 192.168.1.10\n\n# Multiple hosts\nansible-playbook -i hosts.ini zsh-playbook.yml --limit 192.168.1.10,192.168.1.11\n\n# Specific group\nansible-playbook -i hosts.ini zsh-playbook.yml --limit webservers\n"})}),"\n",(0,l.jsx)(n.h2,{id:"part-5-verification",children:"Part 5: Verification"}),"\n",(0,l.jsx)(n.h3,{id:"ssh-into-server",children:"SSH into Server"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ssh admin@192.168.1.10\n"})}),"\n",(0,l.jsx)(n.p,{children:"You should automatically be in ZSH with the Powerlevel10k prompt."}),"\n",(0,l.jsx)(n.h3,{id:"verify-shell",children:"Verify Shell"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"echo $SHELL\n# Output: /usr/bin/zsh\n\nwhich zsh\n# Output: /usr/bin/zsh\n"})}),"\n",(0,l.jsx)(n.h3,{id:"check-oh-my-zsh",children:"Check Oh-My-Zsh"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ls -la ~/.oh-my-zsh\n"})}),"\n",(0,l.jsx)(n.h3,{id:"check-plugins",children:"Check Plugins"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ls ~/.oh-my-zsh/custom/plugins/\n# Output: zsh-autosuggestions  zsh-syntax-highlighting\n"})}),"\n",(0,l.jsx)(n.h3,{id:"check-theme",children:"Check Theme"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ls ~/.oh-my-zsh/custom/themes/\n# Output: powerlevel10k\n"})}),"\n",(0,l.jsx)(n.h3,{id:"test-autosuggestions",children:"Test Autosuggestions"}),"\n",(0,l.jsx)(n.p,{children:"Start typing a command you've used before, and you should see gray suggestions."}),"\n",(0,l.jsx)(n.h3,{id:"test-syntax-highlighting",children:"Test Syntax Highlighting"}),"\n",(0,l.jsx)(n.p,{children:"Commands should be colored (green for valid, red for invalid)."}),"\n",(0,l.jsx)(n.h2,{id:"part-6-customization",children:"Part 6: Customization"}),"\n",(0,l.jsx)(n.h3,{id:"add-more-users",children:"Add More Users"}),"\n",(0,l.jsxs)(n.p,{children:["Edit the ",(0,l.jsx)(n.code,{children:"vars"})," section in the playbook:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"vars:\n  users:\n    - name: admin\n      home: /home/admin\n    - name: developer\n      home: /home/developer\n    - name: johndoe\n      home: /home/johndoe\n    - name: janedoe\n      home: /home/janedoe\n    - name: root\n      home: /root\n"})}),"\n",(0,l.jsx)(n.h3,{id:"add-more-plugins",children:"Add More Plugins"}),"\n",(0,l.jsxs)(n.p,{children:["Edit ",(0,l.jsx)(n.code,{children:"files/zshrc"})," and add plugins to the array:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"plugins=(\n  git\n  docker\n  kubectl\n  docker-compose\n  npm\n  node\n  python\n  pip\n  ansible\n  terraform\n  aws\n  zsh-autosuggestions\n  zsh-syntax-highlighting\n)\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Available plugins: ",(0,l.jsx)(n.a,{href:"https://github.com/ohmyzsh/ohmyzsh/wiki/Plugins",children:"Oh-My-Zsh Plugins"})]}),"\n",(0,l.jsx)(n.h3,{id:"custom-aliases",children:"Custom Aliases"}),"\n",(0,l.jsxs)(n.p,{children:["Add to ",(0,l.jsx)(n.code,{children:"files/zshrc"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# System shortcuts\nalias update='sudo dnf update -y'\nalias install='sudo dnf install'\nalias remove='sudo dnf remove'\n\n# Navigation\nalias ..='cd ..'\nalias ...='cd ../..'\nalias ....='cd ../../..'\n\n# Git shortcuts\nalias gs='git status'\nalias ga='git add'\nalias gc='git commit'\nalias gp='git push'\nalias gl='git log --oneline'\n\n# Docker shortcuts\nalias dps='docker ps'\nalias di='docker images'\nalias dex='docker exec -it'\nalias dlogs='docker logs -f'\n\n# Custom\nalias c='clear'\nalias h='history'\nalias reload='source ~/.zshrc'\n"})}),"\n",(0,l.jsx)(n.h3,{id:"configure-for-specific-distributions",children:"Configure for Specific Distributions"}),"\n",(0,l.jsx)(n.p,{children:"Add conditional tasks based on OS:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'- name: Install additional packages on Ubuntu\n  apt:\n    name: "{{ item }}"\n    state: present\n  loop:\n    - fonts-powerline\n    - zsh-doc\n  when: ansible_distribution == "Ubuntu"\n\n- name: Install additional packages on Rocky Linux\n  dnf:\n    name: "{{ item }}"\n    state: present\n  loop:\n    - powerline-fonts\n    - zsh-html\n  when: ansible_distribution == "Rocky"\n'})}),"\n",(0,l.jsx)(n.h2,{id:"part-7-advanced-configuration",children:"Part 7: Advanced Configuration"}),"\n",(0,l.jsx)(n.h3,{id:"use-ansible-vault-for-sensitive-data",children:"Use Ansible Vault for Sensitive Data"}),"\n",(0,l.jsx)(n.p,{children:"If you need to store sensitive information:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Create encrypted file\nansible-vault create secrets.yml\n"})}),"\n",(0,l.jsx)(n.p,{children:"Add variables:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'admin_password: "SecurePassword123"\n'})}),"\n",(0,l.jsx)(n.p,{children:"Reference in playbook:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"vars_files:\n  - secrets.yml\n"})}),"\n",(0,l.jsx)(n.p,{children:"Run with vault password:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ansible-playbook -i hosts.ini zsh-playbook.yml --ask-vault-pass\n"})}),"\n",(0,l.jsx)(n.h3,{id:"use-ssh-key-authentication",children:"Use SSH Key Authentication"}),"\n",(0,l.jsx)(n.p,{children:"Generate SSH key on control node:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'ssh-keygen -t ed25519 -C "ansible@controlnode"\n'})}),"\n",(0,l.jsx)(n.p,{children:"Copy to target servers:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ssh-copy-id admin@192.168.1.10\nssh-copy-id admin@192.168.1.11\nssh-copy-id admin@192.168.1.12\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Update ",(0,l.jsx)(n.code,{children:"hosts.ini"})," to use specific SSH key:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:"[hosts]\n192.168.1.10 ansible_user=admin ansible_ssh_private_key_file=~/.ssh/ansible_key\n192.168.1.11 ansible_user=admin ansible_ssh_private_key_file=~/.ssh/ansible_key\n"})}),"\n",(0,l.jsx)(n.h3,{id:"install-fonts-optional",children:"Install Fonts (Optional)"}),"\n",(0,l.jsx)(n.p,{children:"For proper Powerlevel10k appearance, install Nerd Fonts:"}),"\n",(0,l.jsx)(n.p,{children:"Add to playbook:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'- name: Download and install MesloLGS NF font\n  block:\n    - name: Create fonts directory\n      file:\n        path: /usr/share/fonts/truetype/meslo\n        state: directory\n        mode: \'0755\'\n\n    - name: Download MesloLGS NF fonts\n      get_url:\n        url: "https://github.com/romkatv/powerlevel10k-media/raw/master/{{ item }}"\n        dest: "/usr/share/fonts/truetype/meslo/{{ item }}"\n      loop:\n        - MesloLGS%20NF%20Regular.ttf\n        - MesloLGS%20NF%20Bold.ttf\n        - MesloLGS%20NF%20Italic.ttf\n        - MesloLGS%20NF%20Bold%20Italic.ttf\n\n    - name: Update font cache\n      command: fc-cache -f -v\n'})}),"\n",(0,l.jsx)(n.admonition,{type:"note",children:(0,l.jsx)(n.p,{children:'Fonts are installed system-wide. Users need to configure their terminal emulator to use "MesloLGS NF" font.'})}),"\n",(0,l.jsx)(n.h2,{id:"part-8-troubleshooting",children:"Part 8: Troubleshooting"}),"\n",(0,l.jsx)(n.h3,{id:"playbook-fails-with-permission-denied",children:"Playbook Fails with Permission Denied"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Issue"}),": SSH connection fails or sudo doesn't work"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Test SSH connection\nssh admin@192.168.1.10\n\n# Test sudo access\nssh admin@192.168.1.10 'sudo whoami'\n# Should output: root\n"})}),"\n",(0,l.jsxs)(n.p,{children:["If sudo requires password, add ",(0,l.jsx)(n.code,{children:"--ask-become-pass"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ansible-playbook -i hosts.ini zsh-playbook.yml --ask-become-pass\n"})}),"\n",(0,l.jsx)(n.h3,{id:"oh-my-zsh-installation-fails",children:"Oh-My-Zsh Installation Fails"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Issue"}),": ",(0,l.jsx)(n.code,{children:"curl"})," command fails or times out"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Solution"}),": Check internet connectivity on target servers"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'ansible -i hosts.ini all -m shell -a "curl -I https://raw.githubusercontent.com"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"shell-doesnt-change",children:"Shell Doesn't Change"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Issue"}),": Users still have bash after running playbook"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Solution"}),": Check if ",(0,l.jsx)(n.code,{children:"/usr/bin/zsh"})," exists in ",(0,l.jsx)(n.code,{children:"/etc/shells"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'ansible -i hosts.ini all -m shell -a "cat /etc/shells"\n'})}),"\n",(0,l.jsx)(n.p,{children:"If missing, add it:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"- name: Add zsh to /etc/shells\n  lineinfile:\n    path: /etc/shells\n    line: /usr/bin/zsh\n    state: present\n"})}),"\n",(0,l.jsx)(n.h3,{id:"plugins-dont-work",children:"Plugins Don't Work"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Issue"}),": Autosuggestions or syntax highlighting not working"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Solution"}),": Verify plugins are loaded in ",(0,l.jsx)(n.code,{children:".zshrc"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ssh admin@192.168.1.10 'grep \"plugins=\" ~/.zshrc'\n"})}),"\n",(0,l.jsx)(n.p,{children:"Ensure plugins are in the array:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"plugins=(\n  git\n  zsh-autosuggestions\n  zsh-syntax-highlighting\n)\n"})}),"\n",(0,l.jsx)(n.h3,{id:"powerlevel10k-not-showing",children:"Powerlevel10k Not Showing"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Issue"}),": Prompt shows ",(0,l.jsx)(n.code,{children:"[oh-my-zsh]"})," instead of Powerlevel10k"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Check theme is set correctly in ",(0,l.jsx)(n.code,{children:".zshrc"}),":"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'ZSH_THEME="powerlevel10k/powerlevel10k"\n'})}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsx)(n.li,{children:"Verify theme directory exists:"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ssh admin@192.168.1.10 'ls ~/.oh-my-zsh/custom/themes/'\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"3",children:["\n",(0,l.jsx)(n.li,{children:"Run configuration wizard:"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ssh admin@192.168.1.10\np10k configure\n"})}),"\n",(0,l.jsx)(n.h2,{id:"part-9-idempotency",children:"Part 9: Idempotency"}),"\n",(0,l.jsx)(n.p,{children:"The playbook is idempotent - safe to run multiple times:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# First run: Installs everything\nansible-playbook -i hosts.ini zsh-playbook.yml\n\n# Second run: Skips already completed tasks (changed=0 for most tasks)\nansible-playbook -i hosts.ini zsh-playbook.yml\n"})}),"\n",(0,l.jsx)(n.p,{children:"Output on second run:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"PLAY RECAP *************************************************\n192.168.1.10  : ok=12   changed=0   unreachable=0   failed=0\n192.168.1.11  : ok=12   changed=0   unreachable=0   failed=0\n"})}),"\n",(0,l.jsx)(n.h2,{id:"part-10-uninstall-optional",children:"Part 10: Uninstall (Optional)"}),"\n",(0,l.jsx)(n.p,{children:"To revert changes:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'---\n- name: Uninstall ZSH configuration\n  hosts: all\n  become: yes\n\n  vars:\n    users:\n      - name: admin\n        home: /home/admin\n      - name: developer\n        home: /home/developer\n\n  tasks:\n    - name: Change shell back to bash\n      command: chsh -s /bin/bash {{ item.name }}\n      loop: "{{ users }}"\n\n    - name: Remove .oh-my-zsh directory\n      file:\n        path: "{{ item.home }}/.oh-my-zsh"\n        state: absent\n      loop: "{{ users }}"\n\n    - name: Remove .zshrc\n      file:\n        path: "{{ item.home }}/.zshrc"\n        state: absent\n      loop: "{{ users }}"\n\n    - name: Remove .p10k.zsh\n      file:\n        path: "{{ item.home }}/.p10k.zsh"\n        state: absent\n      loop: "{{ users }}"\n\n    - name: Uninstall zsh package\n      package:\n        name: zsh\n        state: absent\n'})}),"\n",(0,l.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"Use SSH keys"})," instead of passwords"]}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"Test in development"})," before production"]}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"Use version control"})," for playbooks (git)"]}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"Document changes"})," in commit messages"]}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"Keep backups"})," of original configs"]}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"Use --check mode"})," before executing"]}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"Limit users"})," to only those who need ZSH"]}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"Monitor disk space"})," (Oh-My-Zsh + plugins = ~50MB per user)"]}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"Regular updates"})," to plugins and theme"]}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"User training"})," on ZSH features and shortcuts"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.ansible.com/",children:"Ansible Documentation"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/ohmyzsh/ohmyzsh",children:"Oh-My-Zsh GitHub"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/romkatv/powerlevel10k",children:"Powerlevel10k GitHub"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://zsh.sourceforge.io/Doc/",children:"ZSH Documentation"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/tips_tricks/ansible_tips_tricks.html",children:"Ansible Best Practices"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"example-output",children:"Example Output"}),"\n",(0,l.jsx)(n.p,{children:"Successful playbook execution:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"PLAY [Install and configure zsh] ***************************\n\nTASK [Gathering Facts] *************************************\nok: [192.168.1.10]\nok: [192.168.1.11]\n\nTASK [Install zsh using package manager] *******************\nchanged: [192.168.1.10]\nchanged: [192.168.1.11]\n\nTASK [Install util-linux-user on RHEL-based systems] ******\nchanged: [192.168.1.10]\nchanged: [192.168.1.11]\n\nTASK [Modify /etc/pam.d/chsh for unrestricted chsh] *******\nchanged: [192.168.1.10]\nchanged: [192.168.1.11]\n\nTASK [Change shell for users] ******************************\nchanged: [192.168.1.10] => (item={'name': 'admin', 'home': '/home/admin'})\nchanged: [192.168.1.11] => (item={'name': 'admin', 'home': '/home/admin'})\n\nTASK [Check if .oh-my-zsh exists] **************************\nok: [192.168.1.10]\nok: [192.168.1.11]\n\nTASK [Install .oh-my-zsh] **********************************\nchanged: [192.168.1.10] => (item={'name': 'admin', 'home': '/home/admin'})\nchanged: [192.168.1.11] => (item={'name': 'admin', 'home': '/home/admin'})\n\nTASK [Clone powerlevel10k theme for users] ****************\nchanged: [192.168.1.10]\nchanged: [192.168.1.11]\n\nTASK [Clone zsh-autosuggestions plugin] ********************\nchanged: [192.168.1.10]\nchanged: [192.168.1.11]\n\nTASK [Clone zsh-syntax-highlighting plugin] ****************\nchanged: [192.168.1.10]\nchanged: [192.168.1.11]\n\nTASK [Copy zshrc file] *************************************\nchanged: [192.168.1.10]\nchanged: [192.168.1.11]\n\nTASK [Copy p10k.zsh file] **********************************\nchanged: [192.168.1.10]\nchanged: [192.168.1.11]\n\nPLAY RECAP *************************************************\n192.168.1.10  : ok=12   changed=10   unreachable=0   failed=0\n192.168.1.11  : ok=12   changed=10   unreachable=0   failed=0\n"})})]})}function c(e={}){let{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},65:function(e,n,s){s.d(n,{Z:function(){return r},a:function(){return o}});var i=s(7294);let l={},a=i.createContext(l);function o(e){let n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:o(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);